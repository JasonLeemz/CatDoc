<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="document for catphp">

	<title>Document For CatPHP</title>

	<link rel="stylesheet" href="css/pure-min.css">
    <link rel="stylesheet" href="css/side-menu.css">
</head>
<body>
	<div id="layout">
		<a href="#menu" id="menuLink" class="menu-link">
			<span></span>
		</a>
		<div id="menu">
			<div class="pure-menu">
				<a class="pure-menu-heading" href="/">CatPHP</a>
				<ul class="pure-menu-list">

					<li class="pure-menu-item pure-menu-selected">
						<a href="#start" class="pure-menu-link">快速开始</a>
					</li>

					<li class="pure-menu-item">
						<a href="#before" class="pure-menu-link">前言</a>
					</li>
					<li class="pure-menu-item">
						<a href="#design" class="pure-menu-link">设计思想</a>
					</li>

					<li class="pure-menu-item menu-item-divided">
						<a href="#ext" class="pure-menu-link">扩展框架</a>
					</li>

					<li class="pure-menu-item">
						<a href="/grids/" class="pure-menu-link">配置</a>
					</li>

					<li class="pure-menu-item">
						<a href="/grids/" class="pure-menu-link">路由</a>
					</li>

					<li class="pure-menu-item">
						<a href="/forms/" class="pure-menu-link">模板</a>
					</li>

					<li class="pure-menu-item">
						<a href="/buttons/" class="pure-menu-link">数据库</a>
					</li>

					<li class="pure-menu-item ">
						<a href="/tables/" class="pure-menu-link">sql生成器</a>
					</li>

					<li class="pure-menu-item">
						<a href="/menus/" class="pure-menu-link">参数校验</a>
					</li>

					<li class="pure-menu-item menu-item-divided">
						<a href="/tools/" class="pure-menu-link">日志</a>
					</li>

					<li class="pure-menu-item">
						<a href="/customize/" class="pure-menu-link">HTML生成器</a>
					</li>

					<li class="pure-menu-item">
						<a href="/extend/" class="pure-menu-link">缓存</a>
					</li>

					<li class="pure-menu-item">
						<a href="http://blog.purecss.io/" class="pure-menu-link">多语言</a>
					</li>
					<li class="pure-menu-item">
						<a href="https://github.com/yahoo/pure/releases/" class="pure-menu-link">HTTP Client</a>
					</li>
				</ul>
			</div>
		</div>

        <div id="epiceditor" style="height:960px"></div>

</body>
<script type="text/javascript" src="js/jquery-1.8.3.min.js"></script>
<script src="epiceditor/epiceditor.min.js"></script>
<script type="text/javascript">

    var opts = {
      container: 'epiceditor',
      textarea: null,
      basePath: 'epiceditor',
      clientSideStorage: true,
      localStorageName: 'epiceditor',
      useNativeFullscreen: true,
      parser: marked,
      file: {
        name: 'epiceditor',
        defaultContent: '',
        autoSave: 100
      },
      theme: {
        base: '/themes/base/epiceditor.css',
        preview: '/themes/preview/preview-light.css',
        editor: '/themes/editor/epic-light.css'
      },
      button: {
        preview: true,
        fullscreen: true,
        bar: "auto"
      },
      focusOnLoad: false,
      shortcut: {
        modifier: 18,
        fullscreen: 70,
        preview: 80
      },
      string: {
        togglePreview: '预览模式',
        toggleEdit: '编辑模式',
        toggleFullscreen: '全屏模式'
      },
      autogrow: false
    }
    var doc_id = null
    var editor = new EpicEditor(opts).load();
    editor.on('autosave',function(){
        // var doc_id = $('.pure-menu-selected a').attr('href').substr(1)
        var content = editor.getElement('editor').body.innerHTML
         $.post('http://127.0.0.1/document/save', {doc_id: doc_id,content:content}, function(data, textStatus, xhr) {
            console.log(data);
         });
    })
	// $('.pure-menu-item').click(function(){
	// 	$('.pure-menu-selected').removeClass('pure-menu-selected')
	// 	$(this).addClass('pure-menu-selected')
	// })

    // 添加点击变色
    $('.pure-menu-list').delegate('.pure-menu-item', 'click', function(event) {
        $('.pure-menu-selected').removeClass('pure-menu-selected')
        var t = $(this)
        t.addClass('pure-menu-selected')
        doc_id = t.find('a').attr('href').substr(1)
        $.post('http://127.0.0.1/document/read', {doc_id: doc_id}, function(data, textStatus, xhr) {
            var json_data = jQuery.parseJSON(data);
            // $('#content').empty().append(json_data.info.content)
            editor.getElement('editor').body.innerHTML = json_data.info.content
        });

    });

    // 加载列表
    $.post('http://127.0.0.1/document/lists', {project_id: '555ede4815d55cdc2900003f'}, function(data, textStatus, xhr) {
        var json_data = jQuery.parseJSON(data);
        html_str = ''
        for(v in json_data.info){
            html_str+='<li class="pure-menu-item"><a href="#'+json_data.info[v]['_id']+'" class="pure-menu-link">'+json_data.info[v]['name']+'</a></li>'
        }
        $('.pure-menu-list').append(html_str)
    });
</script>
</html>
